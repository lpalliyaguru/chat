function send(e){var s=e.val();e.val(""),addThread("user",s),$.ajax({type:"POST",url:baseUrl+"query?v=20150910",contentType:"application/json; charset=utf-8",dataType:"json",headers:{Authorization:"Bearer "+accessToken},data:JSON.stringify({query:s,lang:"en",sessionId:"somerandomthing"}),success:function(e){speech=e.result.fulfillment.speech,messages=e.result.fulfillment.messages?e.result.fulfillment.messages:[],message=filterMessage(messages),message=""==message?speech:message,message=message.replace(/(?:\r\n|\r|\n)/g,"<br />"),addThread("agent",message),$("#resultWrapper").stop().animate({scrollTop:$("#resultWrapper")[0].scrollHeight},800)},error:function(){setResponse("Internal Server Error")}})}function filterMessage(e){var s="";for(i in e)messages[i].platform||(s=e[i].speech);return s}function addThread(e,s){var a=$("<div><span>"+s+"</span></div>");"agent"==e?($("<p>"+agentName+":</p>").prependTo(a.find("span")),a.addClass("server-response")):a.addClass("user-request"),$("#result").append(a)}$(function(){$(".agent-input form").submit(function(e){e.preventDefault(),send($(this).find("input"))})});